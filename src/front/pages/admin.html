<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Admin - Boy Happy</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<!-- Export Libraries (CU-25) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<!-- Chart.js (CU-23) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<!-- ‚≠ê SHAREDIFICACI√ìN: Orden correcto de carga -->
<!-- 1. HTTP Client (primero, otros dependen de √©l) -->
<script src="../shared/http-client.js"></script>

<!-- 2. SweetAlert2 (antes de components.js que lo usa) -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- 3. SweetAlert2 Config (modular) -->
<link rel="stylesheet" href="../scripts/admin/swal-styles.css">
<script src="../scripts/admin/swal-config.js"></script>

<!-- 4. Components y Stores (despu√©s de Swal y http-client) -->
<script src="../shared/components.js"></script>
<script src="../shared/hooks.js"></script>
<script src="../shared/api-hooks.js"></script>
<script src="../shared/alpine-components.js"></script>
<script src="../shared/alpine-stores.js"></script>

<!-- 5. Admin Alpine.js Apps (modulares) -->
<script src="../scripts/admin/dashboard-app.js"></script>
<script src="../scripts/admin/usuarios-app.js"></script>
<script src="../scripts/admin/asistencia-app.js"></script>
<script src="../scripts/admin/materiales-app.js"></script>
<script src="../scripts/admin/comparativo-app.js"></script>
<script src="../scripts/admin/matriculas-app.js"></script>

<!-- 6. Alpine.js (AL FINAL, defer) -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- 7. Validaci√≥n de m√≥dulos -->
<script src="../scripts/admin/index.js"></script>

<!-- STYLES -->
<link rel="stylesheet" href="../shared/boyhappy-styles.css">
</head>
<body>
<aside class="sidebar">
  <div class="sidebar-logo">
    <i class="fas fa-graduation-cap"></i>
    <span>Boy Happy</span>
  </div>

  <ul class="sidebar-menu">
    <li><a href="#" onclick="showSection('dashboard'); return false;" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
    <li><a href="#" onclick="showSection('comparativo'); return false;"><i class="fas fa-chart-line"></i> Comparativo Cursos</a></li>
    <li><a href="#" onclick="showSection('usuarios'); return false;"><i class="fas fa-users"></i> Gesti√≥n de Usuarios</a></li>
    <li><a href="#" onclick="showSection('matriculas'); return false;"><i class="fas fa-file-alt"></i> Matr√≠culas</a></li>
    <li><a href="#" onclick="showSection('asistencia'); return false;"><i class="fas fa-calendar-check"></i> Asistencia</a></li>
    <li><a href="#" onclick="showSection('materiales'); return false;"><i class="fas fa-folder-open"></i> Materiales</a></li>
    <li><a href="#" onclick="showSection('retroalimentacion'); return false;"><i class="fas fa-comments"></i> Retroalimentaci√≥n</a></li>
    <li><a href="#" onclick="showSection('categorias'); return false;"><i class="fas fa-tags"></i> Categor√≠as</a></li>
    <li><a href="#" onclick="showSection('anuncios'); return false;"><i class="fas fa-bullhorn"></i> Anuncios</a></li>
    <li><a href="#" onclick="showSection('notificaciones'); return false;"><i class="fas fa-envelope"></i> Notificaciones</a></li>
    <li><a href="#" onclick="showSection('configuracion'); return false;"><i class="fas fa-cogs"></i> Configuraci√≥n</a></li>
  </ul>
  <button class="logout-btn" onclick="cerrarSesion()">
    <i class="fas fa-sign-out-alt"></i>
    <span>Cerrar Sesi√≥n</span>
  </button>
</aside>

<main class="main-content">
  <!-- ‚≠ê Dashboard Section - SHAREDIFICADO con Alpine.js + Hooks -->
  <div id="dashboard" class="section active" x-data="dashboardApp()">
    <div class="content-header">
      <h1><i class="fas fa-tachometer-alt"></i> Dashboard de Indicadores</h1>
    </div>

    <!-- Loading State -->
    <template x-if="loading && !data">
      <div style="text-align: center; padding: 60px 20px; color: #667eea;">
        <i class="fas fa-spinner fa-spin fa-3x"></i>
        <p style="margin-top: 15px; font-size: 1.1em;">Cargando dashboard...</p>
      </div>
    </template>

    <!-- Dashboard Content (solo visible cuando hay datos) -->
    <template x-if="data">
      <div>
        <!-- Indicadores Principales -->
        <div class="dashboard-grid">
          <!-- Usuarios Activos -->
          <div class="indicator-card">
            <div class="indicator-header">
              <i class="fas fa-users fa-2x"></i>
              <h3>Usuarios Activos</h3>
            </div>
            <div class="indicator-value" x-text="indicadores.totalUsuarios"></div>
            <div class="indicator-trend">
              <small style="color: #4caf50;">
                <i class="fas fa-arrow-up"></i>
                <span x-text="indicadores.trendUsuarios"></span>
              </small>
            </div>
          </div>

          <!-- Asistencia Promedio -->
          <div class="indicator-card">
            <div class="indicator-header">
              <i class="fas fa-calendar-check fa-2x"></i>
              <h3>Asistencia Promedio</h3>
            </div>
            <div class="indicator-value" x-text="indicadores.promedioAsistencia"></div>
            <div class="indicator-semaphore" style="display: flex; flex-direction: row; gap: 8px; align-items: center; justify-content: center;">
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoAsistencia === 'red' }"
                   :style="indicadores.semaforoAsistencia === 'red' ? 'background: #f44336' : 'background: #ddd'"></div>
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoAsistencia === 'yellow' }"
                   :style="indicadores.semaforoAsistencia === 'yellow' ? 'background: #ff9800' : 'background: #ddd'"></div>
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoAsistencia === 'green' }"
                   :style="indicadores.semaforoAsistencia === 'green' ? 'background: #4caf50' : 'background: #ddd'"></div>
            </div>
          </div>

          <!-- Materiales Activos -->
          <div class="indicator-card">
            <div class="indicator-header">
              <i class="fas fa-folder fa-2x"></i>
              <h3>Materiales Activos</h3>
            </div>
            <div class="indicator-value" x-text="indicadores.materialesActivos"></div>
            <div class="indicator-semaphore" style="display: flex; flex-direction: row; gap: 8px; align-items: center; justify-content: center;">
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoMateriales === 'red' }"
                   :style="indicadores.semaforoMateriales === 'red' ? 'background: #f44336' : 'background: #ddd'"></div>
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoMateriales === 'yellow' }"
                   :style="indicadores.semaforoMateriales === 'yellow' ? 'background: #ff9800' : 'background: #ddd'"></div>
              <div class="semaphore-light"
                   :class="{ active: indicadores.semaforoMateriales === 'green' }"
                   :style="indicadores.semaforoMateriales === 'green' ? 'background: #4caf50' : 'background: #ddd'"></div>
            </div>
          </div>
        </div>

        <!-- Alertas Cr√≠ticas -->
        <div class="card" style="margin-top: 25px;">
          <h3><i class="fas fa-exclamation-triangle"></i> Alertas y Acciones Requeridas</h3>
          <div style="margin-top: 15px;">
            <template x-if="alertas.length === 0">
              <p style="color: #4caf50; text-align: center;">
                <i class="fas fa-check-circle"></i> No hay alertas cr√≠ticas
              </p>
            </template>

            <template x-for="alerta in alertas" :key="alerta.mensaje">
              <div :style="`padding: 15px; margin-bottom: 10px; border-radius: 8px; background: ${alerta.color}15; border-left: 4px solid ${alerta.color}; display: flex; justify-content: space-between; align-items: center;`">
                <div style="display: flex; align-items: center; gap: 12px;">
                  <i :class="'fas ' + alerta.icono" :style="`color: ${alerta.color}; font-size: 1.5em;`"></i>
                  <div>
                    <strong x-text="alerta.mensaje" :style="`color: ${alerta.color};`"></strong>
                    <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                      Prioridad: <span x-text="alerta.prioridad.toUpperCase()"></span>
                    </div>
                  </div>
                </div>
                <button class="btn btn-sm" :style="`background: ${alerta.color}; color: white;`"
                        @click="showSection(alerta.seccion)">
                  <i class="fas fa-arrow-right"></i>
                  <span x-text="alerta.accion"></span>
                </button>
              </div>
            </template>
          </div>
        </div>

        <!-- Resumen por Curso -->
        <div class="card" style="margin-top: 25px;">
          <h3><i class="fas fa-chart-bar"></i> Resumen por Curso</h3>

          <!-- Mensaje si no hay datos -->
          <template x-if="resumenCursos.length === 0">
            <p style="text-align: center; color: #999; padding: 40px;">
              <i class="fas fa-info-circle"></i> No hay datos de cursos disponibles
            </p>
          </template>

          <!-- Grid de cursos -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px;">
            <template x-for="(curso, index) in resumenCursos" :key="curso.codigo">
              <div class="card"
                   :style="`background: white; border: 3px solid ${$store.utils.getCursoColor(index)}; color: #333; padding: 20px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);`"
                   @click="console.log('Click en curso:', curso.codigo)"
                   @mouseenter="$el.style.transform = 'translateY(-4px)'; $el.style.boxShadow = '0 8px 16px rgba(0,0,0,0.15)'"
                   @mouseleave="$el.style.transform = 'translateY(0)'; $el.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)'">

                <!-- Nombre del curso con sem√°foro -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                  <h4 :style="`margin: 0; color: ${$store.utils.getCursoColor(index)}; font-weight: 600;`" x-text="curso.nombre"></h4>
                  <div class="semaphore-light active"
                       :style="`width: 16px; height: 16px; background: ${curso.semaforoColor}; box-shadow: 0 0 8px ${curso.semaforoColor};`">
                  </div>
                </div>

                <!-- M√©tricas -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                  <div>
                    <div style="font-size: 0.85em; color: #666; margin-bottom: 4px;">
                      <i class="fas fa-users" :style="`color: ${$store.utils.getCursoColor(index)}`"></i> Alumnos
                    </div>
                    <div :style="`font-size: 1.6em; font-weight: bold; color: ${$store.utils.getCursoColor(index)};`" x-text="curso.alumnos"></div>
                  </div>

                  <div>
                    <div style="font-size: 0.85em; color: #666; margin-bottom: 4px;">
                      <i class="fas fa-calendar-check" :style="`color: ${$store.utils.getCursoColor(index)}`"></i> Asistencia
                    </div>
                    <div :style="`font-size: 1.6em; font-weight: bold; color: ${$store.utils.getCursoColor(index)};`" x-text="curso.asistencia"></div>
                  </div>
                </div>

                <!-- Materiales -->
                <div :style="`margin-top: 15px; padding-top: 15px; border-top: 2px solid ${$store.utils.getCursoColor(index)}33;`">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.85em; color: #666;">
                      <i class="fas fa-book" :style="`color: ${$store.utils.getCursoColor(index)}`"></i> Materiales publicados
                    </span>
                    <span :style="`font-size: 1.1em; font-weight: bold; color: ${$store.utils.getCursoColor(index)};`" x-text="`${curso.materialesPublicados}/${curso.materialesTotal}`"></span>
                  </div>
                </div>

                <!-- Detalle de registros -->
                <div style="margin-top: 10px; font-size: 0.75em; color: #999; text-align: right;">
                  <span x-text="`${curso.registrosAsistencia} registros`"></span>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </template>
  </div>

  <!-- Comparativo Multi-Curso Section (CU-23) - MIGRADO A ALPINE -->
  <div id="comparativo" class="section" x-data="comparativoApp()">
    <div class="content-header">
      <h1><i class="fas fa-chart-line"></i> Comparativo Multi-Curso</h1>
    </div>

    <!-- Loading State -->
    <template x-if="loading">
      <div style="text-align: center; padding: 60px 20px; color: #667eea;">
        <i class="fas fa-spinner fa-spin fa-3x"></i>
        <p style="margin-top: 15px; font-size: 1.1em;">Cargando datos comparativos...</p>
      </div>
    </template>

    <!-- Selector de Cursos -->
    <div class="card">
      <h3><i class="fas fa-filter"></i> Seleccionar Cursos para Comparar</h3>
      <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px;">
        <template x-for="curso in cursos" :key="curso.codigo">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox"
                   :value="curso.codigo"
                   x-model="cursosSeleccionados"
                   class="curso-checkbox">
            <span x-text="curso.nombre"></span>
          </label>
        </template>
      </div>

      <!-- Filtro de Per√≠odo -->
      <div class="form-row" style="margin-top: 20px;">
        <div class="form-group">
          <label>Per√≠odo Desde</label>
          <input type="date" x-model="fechaInicio">
        </div>
        <div class="form-group">
          <label>Per√≠odo Hasta</label>
          <input type="date" x-model="fechaFin">
        </div>
      </div>
    </div>

    <!-- Gr√°fico de Asistencia -->
    <div class="card" style="margin-top: 25px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3><i class="fas fa-chart-bar"></i> Asistencia Promedio por Curso</h3>
        <button class="btn btn-sm btn-success" @click="exportarGrafico('chartAsistencia', 'asistencia_comparativo')">
          <i class="fas fa-download"></i> Exportar PNG
        </button>
      </div>
      <canvas id="chartAsistencia" style="max-height: 400px;"></canvas>
    </div>

    <!-- Gr√°fico de Evoluci√≥n Temporal -->
    <div class="card" style="margin-top: 25px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3><i class="fas fa-chart-line"></i> Evoluci√≥n de Asistencia en el Tiempo</h3>
        <button class="btn btn-sm btn-success" @click="exportarGrafico('chartEvolucion', 'evolucion_asistencia')">
          <i class="fas fa-download"></i> Exportar PNG
        </button>
      </div>
      <canvas id="chartEvolucion" style="max-height: 400px;"></canvas>
    </div>

    <!-- Gr√°fico de Niveles de Logro -->
    <div class="card" style="margin-top: 25px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3><i class="fas fa-chart-pie"></i> Distribuci√≥n de Niveles de Logro</h3>
        <button class="btn btn-sm btn-success" @click="exportarGrafico('chartNiveles', 'niveles_logro')">
          <i class="fas fa-download"></i> Exportar PNG
        </button>
      </div>
      <canvas id="chartNiveles" style="max-height: 400px;"></canvas>
    </div>

    <!-- Tabla Comparativa -->
    <div class="card" style="margin-top: 25px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3><i class="fas fa-table"></i> Resumen Num√©rico Comparativo</h3>
        <button class="btn btn-sm btn-success" @click="exportarTablaExcel()">
          <i class="fas fa-file-excel"></i> Exportar a Excel
        </button>
      </div>

      <!-- Tabla renderizada con Alpine -->
      <template x-if="datosComparativos.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Curso</th>
              <th>Asistencia (%)</th>
              <th>Total Evaluaciones</th>
              <th>Logrado (L)</th>
              <th>En Desarrollo (OD)</th>
              <th>No Logrado (NL)</th>
              <th>No Trabajado (NT)</th>
              <th>Promedio</th>
              <th>Materiales</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="d in datosComparativos" :key="d.codigo">
              <tr>
                <td><strong x-text="d.curso"></strong></td>
                <td :style="`background: ${getColorFondo(d.asistencia)};`" x-text="d.asistencia + '%'"></td>
                <td x-text="d.totalEvaluaciones"></td>
                <td x-text="d.logrado"></td>
                <td x-text="d.enDesarrollo"></td>
                <td x-text="d.noLogrado"></td>
                <td x-text="d.noTrabajado"></td>
                <td><strong x-text="d.promedioNumerico"></strong></td>
                <td x-text="d.materiales"></td>
              </tr>
            </template>
          </tbody>
        </table>
      </template>

      <template x-if="datosComparativos.length === 0">
        <p style="text-align: center; color: #999; padding: 40px;">
          <i class="fas fa-info-circle"></i> Selecciona cursos y per√≠odo para ver el comparativo
        </p>
      </template>
    </div>
  </div>

  <!-- Anuncios Section -->
  <div id="anuncios" class="section">
    <div class="content-header">
      <h1><i class="fas fa-bullhorn"></i> Gesti√≥n de Anuncios</h1>
    </div>
    <div class="form-container">
      <form id="anuncioForm">
        <div class="form-group">
          <label for="titulo">T√≠tulo del Anuncio</label>
          <input type="text" id="titulo" placeholder="T√≠tulo" required>
        </div>
        <div class="form-group">
          <label for="contenido">Contenido</label>
          <textarea id="contenido" placeholder="Contenido del anuncio" required style="height: 120px;"></textarea>
        </div>
        <div class="form-group">
          <label for="destinatarios">Destinatarios</label>
          <select id="destinatarios">
            <option value="todos">Todos</option>
            <option value="profesores">Solo Profesores</option>
            <option value="alumnos">Solo Alumnos</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Publicar Anuncio</button>
      </form>
    </div>

    <div class="card">
      <h3>Anuncios Publicados</h3>
      <div id="listaAnuncios"></div>
    </div>
  </div>

  <!-- Notificaciones Section -->
  <div id="notificaciones" class="section">
    <div class="content-header">
      <h1><i class="fas fa-envelope"></i> Enviar Notificaciones por Email</h1>
    </div>
    <div class="form-container">
      <form id="notifForm">
        <div class="form-group">
          <label for="destNotif">Destinatarios:</label>
          <select id="destNotif">
            <option value="todos">Todos los usuarios</option>
            <option value="admin">Solo Administradores</option>
            <option value="profesor">Solo Profesores</option>
            <option value="fono">Solo Fonoaudi√≥logos</option>
            <option value="alumno">Solo Alumnos/Apoderados</option>
          </select>
        </div>

        <div class="form-group">
          <label for="asuntoNotif">Asunto:</label>
          <input type="text" id="asuntoNotif" placeholder="Asunto del correo" required>
        </div>

        <div class="form-group">
          <label for="mensajeNotif">Mensaje:</label>
          <textarea id="mensajeNotif" placeholder="Contenido del mensaje..." required style="height: 200px;"></textarea>
        </div>

        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Enviar Email</button>
      </form>

      <div id="notifStatus" style="margin-top: 20px; padding: 15px; display: none; border-radius: 12px;"></div>
    </div>
  </div>

  <!-- Matr√≠culas Section - MIGRADO A ALPINE.JS -->
  <div id="matriculas" class="section" x-data="matriculasApp()">
    <div class="content-header">
      <h1><i class="fas fa-file-alt"></i> Solicitudes de Matr√≠cula</h1>
    </div>

    <!-- Estad√≠sticas -->
    <div class="dashboard-grid" style="margin-bottom: 25px;">
      <div class="indicator-card">
        <div class="indicator-header">
          <i class="fas fa-clock fa-2x" style="color: #ff9800;"></i>
          <h3>Pendientes</h3>
        </div>
        <div class="indicator-value" x-text="estadisticas.pendientes"></div>
      </div>

      <div class="indicator-card">
        <div class="indicator-header">
          <i class="fas fa-check-circle fa-2x" style="color: #4caf50;"></i>
          <h3>Aprobadas</h3>
        </div>
        <div class="indicator-value" x-text="estadisticas.aprobadas"></div>
      </div>

      <div class="indicator-card">
        <div class="indicator-header">
          <i class="fas fa-times-circle fa-2x" style="color: #f44336;"></i>
          <h3>Rechazadas</h3>
        </div>
        <div class="indicator-value" x-text="estadisticas.rechazadas"></div>
      </div>

      <div class="indicator-card">
        <div class="indicator-header">
          <i class="fas fa-file-alt fa-2x" style="color: #667eea;"></i>
          <h3>Total</h3>
        </div>
        <div class="indicator-value" x-text="estadisticas.total"></div>
      </div>
    </div>

    <!-- Filtros -->
    <div class="card" style="margin-bottom: 20px;">
      <h3>Filtros</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Estado</label>
          <select x-model="filtroEstado">
            <option value="">Todas</option>
            <option value="pendiente">Pendientes</option>
            <option value="aprobada">Aprobadas</option>
            <option value="rechazada">Rechazadas</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <template x-if="matriculas.loading && !matriculas.data">
      <div class="card" style="text-align: center; padding: 40px;">
        <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea;"></i>
        <p style="margin-top: 15px;">Cargando solicitudes...</p>
      </div>
    </template>

    <!-- Lista de Matr√≠culas -->
    <template x-if="matriculas.data">
      <div class="card">
        <h3 x-text="`Solicitudes (${matriculasFiltradas.length})`"></h3>

        <template x-if="matriculasFiltradas.length === 0">
          <p style="text-align: center; color: #666; padding: 30px;">
            No hay solicitudes de matr√≠cula
          </p>
        </template>

        <template x-if="matriculasFiltradas.length > 0">
          <table class="data-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>RUT</th>
                <th>Email</th>
                <th>Tel√©fono</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="mat in matriculasFiltradas" :key="mat.id">
                <tr>
                  <td><strong x-text="mat.nombre"></strong></td>
                  <td x-text="mat.rut"></td>
                  <td x-text="mat.correo"></td>
                  <td x-text="mat.telefono || '-'"></td>
                  <td x-text="formatDate(mat.fechaRegistro)"></td>
                  <td>
                    <span :style="`background: ${getEstadoColor(mat.estado)}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.9em;`"
                          x-text="getEstadoTexto(mat.estado)"></span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-primary" @click="verDetalle(mat)" title="Ver Detalle">
                      <i class="fas fa-eye"></i>
                    </button>

                    <template x-if="mat.estado === 'pendiente'">
                      <button class="btn btn-sm btn-success" @click="aprobarMatricula(mat)" title="Aprobar">
                        <i class="fas fa-check"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" @click="rechazarMatricula(mat)" title="Rechazar">
                        <i class="fas fa-times"></i>
                      </button>
                    </template>

                    <template x-if="mat.estado === 'aprobada' && !mat.usuarioCreado">
                      <button class="btn btn-sm btn-success" @click="crearUsuarioDesdeMatricula(mat)" title="Crear Usuario">
                        <i class="fas fa-user-plus"></i> Crear Usuario
                      </button>
                    </template>

                    <template x-if="mat.usuarioCreado">
                      <span style="color: #4caf50; font-size: 0.85em;">
                        <i class="fas fa-check-circle"></i> Usuario creado
                      </span>
                    </template>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </template>
      </div>
    </template>
  </div>

  <!-- Asistencia Section -->
  <!-- ‚úÖ Asistencia Section - MIGRADO A ALPINE.JS -->
  <div id="asistencia" class="section" x-data="asistenciaApp()">
    <div class="content-header">
      <h1><i class="fas fa-calendar-check"></i> Supervisi√≥n de Asistencia</h1>
    </div>

    <div class="card">
      <h3>Filtros</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Curso</label>
          <select x-model="filtros.curso" @change="aplicarFiltros()">
            <option value="">Todos los cursos</option>
            <option value="medio-mayor">Medio Mayor</option>
            <option value="prekinder-a">Prek√≠nder A</option>
            <option value="prekinder-b">Prek√≠nder B</option>
            <option value="kinder">K√≠nder</option>
            <option value="extension">Extensi√≥n Horaria</option>
          </select>
        </div>

        <div class="form-group">
          <label>Desde</label>
          <input type="date" x-model="filtros.fechaInicio" @change="aplicarFiltros()">
        </div>

        <div class="form-group">
          <label>Hasta</label>
          <input type="date" x-model="filtros.fechaFin" @change="aplicarFiltros()">
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div :style="(asistencia.loading && !asistencia.data) ? '' : 'display: none'" class="card" style="margin-top: 20px; text-align: center; padding: 40px;">
      <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea;"></i>
      <p style="margin-top: 15px;">Cargando asistencia...</p>
    </div>

    <!-- Resumen General -->
    <div :style="asistencia.data ? '' : 'display: none'">
      <div>
        <div class="card" style="margin-top: 20px;">
          <h3>Resumen General</h3>
          <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
            <div class="stat-card presente">
              <i class="fas fa-check"></i>
              <div>
                <h4 x-text="resumen.presente"></h4>
                <p>Presentes</p>
              </div>
            </div>
            <div class="stat-card ausente">
              <i class="fas fa-times"></i>
              <div>
                <h4 x-text="resumen.ausente"></h4>
                <p>Ausentes</p>
              </div>
            </div>
            <div class="stat-card atrasado">
              <i class="fas fa-clock"></i>
              <div>
                <h4 x-text="resumen.atrasado"></h4>
                <p>Atrasados</p>
              </div>
            </div>
            <div class="stat-card porcentaje">
              <i class="fas fa-percentage"></i>
              <div>
                <h4 x-text="resumen.porcentaje + '%'"></h4>
                <p>Asistencia</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Detalle por Alumno -->
        <div class="card" style="margin-top: 20px;">
          <h3>Detalle por Alumno</h3>

          <p :style="(detalleAlumnos && detalleAlumnos.length === 0) ? '' : 'display: none'" style="text-align: center; padding: 30px; color: #999;">
            No hay registros de asistencia para los filtros seleccionados.
          </p>

          <table :style="(detalleAlumnos && detalleAlumnos.length > 0) ? '' : 'display: none'" style="width: 100%; margin-top: 15px;">
              <thead>
                <tr>
                  <th>Alumno</th>
                  <th>RUT</th>
                  <th>Curso</th>
                  <th>Presente</th>
                  <th>Ausente</th>
                  <th>Atrasado</th>
                  <th>% Asistencia</th>
                  <th>Alerta</th>
                </tr>
              </thead>
              <tbody>
                <template x-for="a in (detalleAlumnos || [])" :key="a.rut">
                  <tr :style="a.tieneAlerta ? 'background-color: #ffe6e6;' : ''">
                    <td x-text="a.nombre"></td>
                    <td x-text="a.rut"></td>
                    <td x-text="a.curso"></td>
                    <td><span class="badge-presente" x-text="a.presente"></span></td>
                    <td><span class="badge-ausente" x-text="a.ausente"></span></td>
                    <td><span class="badge-atrasado" x-text="a.atrasado"></span></td>
                    <td><strong x-text="a.porcentaje + '%'"></strong></td>
                    <td>
                      <span :style="a.tieneAlerta ? '' : 'display: none'" style="color: red;">‚ö†Ô∏è Bajo</span>
                      <span :style="!a.tieneAlerta ? '' : 'display: none'">‚úÖ</span>
                    </td>
                  </tr>
                </template>
              </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Categor√≠as Section -->
  <div id="categorias" class="section">
    <div class="content-header">
      <h1><i class="fas fa-tags"></i> Gesti√≥n de Categor√≠as</h1>
      <button class="btn btn-primary" onclick="mostrarFormularioCategoria()"><i class="fas fa-plus"></i> Nueva Categor√≠a</button>
    </div>

    <div id="formCategoria" class="form-container" style="display:none;">
      <h3 id="tituloFormCategoria">Crear Nueva Categor√≠a</h3>
      <div class="form-group">
        <label for="nombreCategoria">Nombre *</label>
        <input type="text" id="nombreCategoria" placeholder="Ej: Matem√°ticas, Lenguaje..." required>
      </div>
      <div class="form-group">
        <label for="descripcionCategoria">Descripci√≥n</label>
        <textarea id="descripcionCategoria" rows="2" placeholder="Descripci√≥n de la categor√≠a (opcional)"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="colorCategoria">Color</label>
          <input type="color" id="colorCategoria" value="#4A90E2">
        </div>
        <div class="form-group">
          <label for="iconoCategoria">Icono (FontAwesome)</label>
          <input type="text" id="iconoCategoria" placeholder="folder, book, file..." value="folder">
        </div>
      </div>
      <input type="hidden" id="categoriaIdEditar">
      <button class="btn btn-success" onclick="guardarCategoria()">Guardar Categor√≠a</button>
      <button class="btn btn-secondary" onclick="ocultarFormularioCategoria()">Cancelar</button>
    </div>

    <div class="card">
      <h3>Lista de Categor√≠as</h3>
      <div id="listaCategorias" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;"></div>
    </div>
  </div>

  <!-- ‚úÖ Materiales Section - MIGRADO A ALPINE.JS -->
  <div id="materiales" class="section" x-data="materialesApp()">
    <div class="content-header">
      <h1><i class="fas fa-folder-open"></i> Supervisi√≥n de Materiales Pedag√≥gicos</h1>
    </div>

    <div class="card">
      <h3>Filtros</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Estado</label>
          <select x-model="filtros.estado" @change="aplicarFiltros()">
            <option value="">Todos</option>
            <option value="pendiente">Pendiente Revisi√≥n</option>
            <option value="aprobado">Aprobado</option>
            <option value="rechazado">Rechazado</option>
            <option value="requiere_correccion">Requiere Correcci√≥n</option>
          </select>
        </div>
        <div class="form-group">
          <label>Curso</label>
          <select x-model="filtros.curso" @change="aplicarFiltros()">
            <option value="">Todos</option>
            <option value="medio-mayor">Medio Mayor</option>
            <option value="prekinder-a">Prek√≠nder A</option>
            <option value="prekinder-b">Prek√≠nder B</option>
            <option value="kinder">K√≠nder</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div :style="(materiales.loading && !materiales.data) ? '' : 'display: none'" class="card" style="margin-top: 20px; text-align: center; padding: 40px;">
      <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea;"></i>
      <p style="margin-top: 15px;">Cargando materiales...</p>
    </div>

    <!-- Materiales Table -->
    <div :style="materiales.data ? '' : 'display: none'" class="card" style="margin-top: 20px;">
      <h3 x-text="`Materiales Encontrados (${(materialesFiltrados || []).length})`"></h3>

      <p :style="(materialesFiltrados && materialesFiltrados.length === 0) ? '' : 'display: none'" style="text-align: center; color: #666; padding: 30px;">
        No se encontraron materiales
      </p>

      <table :style="(materialesFiltrados && materialesFiltrados.length > 0) ? '' : 'display: none'" class="data-table">
            <thead>
              <tr>
                <th>T√≠tulo</th>
                <th>Curso</th>
                <th>Asignatura</th>
                <th>Profesor</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="mat in (materialesFiltrados || [])" :key="mat.id">
                <tr>
                  <td><strong x-text="mat.titulo"></strong></td>
                  <td x-text="mat.curso"></td>
                  <td x-text="mat.asignatura"></td>
                  <td x-text="mat.profesor"></td>
                  <td x-text="$store.utils.formatDate(mat.fechaSubida)"></td>
                  <td>
                    <span :style="`background: ${$store.utils.getEstadoColor(mat.estado)}; color: white; padding: 4px 12px; border-radius: 12px;`"
                          x-text="$store.utils.getEstadoTexto(mat.estado)"></span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-primary" @click="verDetalle(mat)" title="Ver Detalle">
                      <i class="fas fa-eye"></i>
                    </button>
                    <template x-if="mat.estado === 'pendiente' || mat.estado === 'requiere_correccion'">
                      <button class="btn btn-sm btn-success" @click="aprobar(mat)" title="Aprobar">
                        <i class="fas fa-check"></i>
                      </button>
                      <button class="btn btn-sm btn-danger" @click="rechazar(mat)" title="Rechazar">
                        <i class="fas fa-times"></i>
                      </button>
                      <button class="btn btn-sm btn-warning" @click="solicitarCorreccion(mat)" title="Solicitar Correcci√≥n">
                        <i class="fas fa-edit"></i>
                      </button>
                    </template>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
      </div>
    </div>
  </div>

  <!-- Configuraci√≥n Section (CU-11, 12) -->
  <div id="configuracion" class="section">
    <div class="content-header">
      <h1><i class="fas fa-cogs"></i> Configuraci√≥n del Sistema</h1>
    </div>

    <div class="card">
      <h3>Informaci√≥n del Jard√≠n</h3>
      <div class="form-group">
        <label for="nombreJardin">Nombre del Jard√≠n</label>
        <input type="text" id="nombreJardin" placeholder="Nombre del establecimiento">
      </div>
      <div class="form-group">
        <label for="direccionJardin">Direcci√≥n</label>
        <input type="text" id="direccionJardin" placeholder="Direcci√≥n del jard√≠n">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="telefonoJardin">Tel√©fono</label>
          <input type="tel" id="telefonoJardin" placeholder="+56 9 XXXX XXXX">
        </div>
        <div class="form-group">
          <label for="emailJardin">Email</label>
          <input type="email" id="emailJardin" placeholder="contacto@jardin.cl">
        </div>
      </div>
      <div class="form-group">
        <label for="anoEscolar">A√±o Escolar</label>
        <input type="number" id="anoEscolar" min="2020" max="2050" value="2025">
      </div>
    </div>

    <div class="card">
      <h3>Cursos</h3>
      <div id="listaCursos"></div>
      <button class="btn btn-sm btn-primary" onclick="agregarCurso()" style="margin-top: 10px;">
        <i class="fas fa-plus"></i> Agregar Curso
      </button>
    </div>

    <div class="card">
      <h3>Asignaturas / N√∫cleos de Aprendizaje</h3>
      <div id="listaAsignaturas"></div>
      <button class="btn btn-sm btn-primary" onclick="agregarAsignatura()" style="margin-top: 10px;">
        <i class="fas fa-plus"></i> Agregar Asignatura
      </button>
    </div>

    <button class="btn btn-success" onclick="guardarConfiguracion()">
      <i class="fas fa-save"></i> Guardar Configuraci√≥n
    </button>
  </div>

  <!-- Retroalimentaci√≥n Section (CU-20, 21, 22) -->
  <div id="retroalimentacion" class="section">
    <div class="content-header">
      <h1><i class="fas fa-comments"></i> Gesti√≥n de Retroalimentaci√≥n</h1>
    </div>

    <!-- CU-20: Enviar Retroalimentaci√≥n -->
    <div class="card">
      <h3><i class="fas fa-plus-circle"></i> Enviar Nueva Retroalimentaci√≥n</h3>
      <form id="formRetroalimentacion" onsubmit="enviarRetroalimentacion(event)">
        <div class="form-row">
          <div class="form-group">
            <label for="retroUsuario">Usuario *</label>
            <select id="retroUsuario" required>
              <option value="">-- Seleccionar usuario --</option>
            </select>
          </div>

          <div class="form-group">
            <label for="retroTipo">Tipo de Retroalimentaci√≥n *</label>
            <select id="retroTipo" required>
              <option value="">-- Seleccionar tipo --</option>
              <option value="desempeno_general">üìä Desempe√±o General</option>
              <option value="conducta">üé≠ Conducta</option>
              <option value="logro_destacado">‚≠ê Logro Destacado</option>
              <option value="area_mejora">üìà √Årea de Mejora</option>
              <option value="observacion_general">üìù Observaci√≥n General</option>
              <option value="retroalimentacion_padres">üë®‚Äçüë©‚Äçüëß Retroalimentaci√≥n a Padres</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="retroContenido">Contenido *</label>
          <textarea id="retroContenido" rows="5" required
                    placeholder="Escribe tu retroalimentaci√≥n aqu√≠... S√© espec√≠fico y constructivo."></textarea>
          <small style="color: #666; display: block; margin-top: 5px;">
            <i class="fas fa-lightbulb"></i> Tip: Una buena retroalimentaci√≥n es espec√≠fica, constructiva y orientada a la mejora.
          </small>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="retroVisibilidad">Visibilidad</label>
            <select id="retroVisibilidad">
              <option value="privada">üîí Privada (solo admin/direcci√≥n)</option>
              <option value="publica">üåê P√∫blica (visible para el usuario)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="retroAmbito">√Åmbito (Opcional)</label>
            <select id="retroAmbito">
              <option value="">-- Sin especificar --</option>
              <option value="academico">üìö Acad√©mico</option>
              <option value="conductual">üéØ Conductual</option>
              <option value="socioemocional">‚ù§Ô∏è Socioemocional</option>
              <option value="psicomotor">ü§∏ Psicomotor</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="retroCurso">Curso (Opcional)</label>
          <select id="retroCurso">
            <!-- Los cursos se cargar√°n din√°micamente -->
          </select>
        </div>

        <button type="submit" class="btn btn-success">
          <i class="fas fa-paper-plane"></i> Enviar Retroalimentaci√≥n
        </button>
      </form>
    </div>

    <!-- CU-22: Ver Historial de Retroalimentaci√≥n -->
    <div class="card" style="margin-top: 25px;">
      <h3><i class="fas fa-history"></i> Historial de Retroalimentaci√≥n</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="historialUsuario">Buscar por Usuario:</label>
          <select id="historialUsuario" onchange="cargarHistorialRetro()">
            <option value="">-- Todos los usuarios --</option>
          </select>
        </div>

        <div class="form-group">
          <label for="filtroTipoRetro">Filtrar por Tipo:</label>
          <select id="filtroTipoRetro" onchange="cargarHistorialRetro()">
            <option value="">Todos los tipos</option>
            <option value="desempeno_general">Desempe√±o General</option>
            <option value="conducta">Conducta</option>
            <option value="logro_destacado">Logro Destacado</option>
            <option value="area_mejora">√Årea de Mejora</option>
            <option value="observacion_general">Observaci√≥n General</option>
            <option value="retroalimentacion_padres">Retroalimentaci√≥n a Padres</option>
          </select>
        </div>

        <div class="form-group">
          <label for="filtroAmbitoRetro">Filtrar por √Åmbito:</label>
          <select id="filtroAmbitoRetro" onchange="cargarHistorialRetro()">
            <option value="">Todos los √°mbitos</option>
            <option value="academico">Acad√©mico</option>
            <option value="conductual">Conductual</option>
            <option value="socioemocional">Socioemocional</option>
            <option value="psicomotor">Psicomotor</option>
          </select>
        </div>
      </div>

      <div id="estadisticasRetro" class="stats-grid" style="margin: 20px 0;"></div>

      <div id="historialRetroalimentacion" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- Gesti√≥n de Usuarios Section (Consolidado: Usuarios, Cursos, Profesores, Aceptados) -->
  <!-- Usuarios Section -->
  <div id="usuarios" class="section" x-data="usuariosApp()">
    <div class="content-header">
      <h1><i class="fas fa-users"></i> Gesti√≥n de Usuarios</h1>
      <button class="btn btn-primary" @click="mostrarFormulario = !mostrarFormulario">
        <i class="fas fa-plus"></i> Nuevo Usuario
      </button>
    </div>

    <!-- Filtros -->
    <div class="card" style="margin-bottom: 20px;">
      <h3>Filtros</h3>
      <div class="form-row">
        <div class="form-group">
          <label>Buscar</label>
          <input type="text" x-model="filtros.busqueda" placeholder="Buscar por nombre, RUT o correo...">
        </div>
        <div class="form-group">
          <label>Rol</label>
          <select x-model="filtros.rol">
            <option value="">Todos los roles</option>
            <option value="profesor">Profesores</option>
            <option value="fono">Fonoaudi√≥logos</option>
            <option value="alumno">Alumnos/Apoderados</option>
          </select>
        </div>
        <div class="form-group">
          <label>Estado</label>
          <select x-model="filtros.estado">
            <option value="">Todos los estados</option>
            <option value="activo">Activos</option>
            <option value="inactivo">Inactivos</option>
          </select>
        </div>
      </div>
    </div>

      <!-- Formulario de Nuevo Usuario -->
      <div :style="mostrarFormulario ? '' : 'display: none'" class="form-container" style="margin-bottom: 20px;">
        <h3 x-text="usuarioEditando ? 'Editar Usuario' : 'Crear Nuevo Usuario'"></h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <!-- Columna 1 -->
          <div>
            <div class="form-group">
              <label>RUT <span style="color: red;">*</span></label>
              <input type="text" x-model="nuevoUsuario.rut" placeholder="12345678-9" required :disabled="!!usuarioEditando">
            </div>

            <div class="form-group">
              <label>Nombre <span style="color: red;">*</span></label>
              <input type="text" x-model="nuevoUsuario.nombre" placeholder="Nombre" required>
            </div>

            <div class="form-group">
              <label>Apellido <span style="color: red;">*</span></label>
              <input type="text" x-model="nuevoUsuario.apellido" placeholder="Apellido" required>
            </div>

            <div class="form-group">
              <label>Correo Electr√≥nico <span style="color: red;">*</span></label>
              <input type="email" x-model="nuevoUsuario.correo" placeholder="correo@ejemplo.com" required>
            </div>
          </div>

          <!-- Columna 2 -->
          <div>
            <div class="form-group">
              <label>Tel√©fono</label>
              <input type="tel" x-model="nuevoUsuario.telefono" placeholder="+56 9 1234 5678">
            </div>

            <div class="form-group">
              <label>Rol <span style="color: red;">*</span></label>
              <select x-model="nuevoUsuario.rol" required>
                <option value="">Seleccione un rol</option>
                <option value="profesor">Profesor/Docente</option>
                <option value="fono">Fonoaudi√≥logo/a</option>
                <option value="alumno">Alumno/Apoderado</option>
              </select>
            </div>

            <div class="form-group" x-show="usuarioEditando">
              <label>Estado</label>
              <select x-model="nuevoUsuario.activo">
                <option :value="true">Activo</option>
                <option :value="false">Inactivo</option>
              </select>
            </div>
          </div>
        </div>

        <div style="margin-top: 20px; display: flex; gap: 10px;">
          <button class="btn btn-success" @click="guardarUsuario()" :disabled="crearMutation.loading || updateMutation.loading">
            <i class="fas fa-save"></i>
            <span x-text="(crearMutation.loading || updateMutation.loading) ? 'Guardando...' : (usuarioEditando ? 'Actualizar Usuario' : 'Guardar Usuario')"></span>
          </button>
          <button class="btn btn-secondary" @click="cancelarFormulario()">
            <i class="fas fa-times"></i> Cancelar
          </button>
        </div>
      </div>

      <!-- Tabla de Usuarios -->
      <div class="card">
        <h3>Lista de Usuarios</h3>

        <!-- Loading state -->
        <div :style="(usuarios.loading && !usuarios.data) ? '' : 'display: none'" style="text-align: center; padding: 30px;">
          <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea;"></i>
          <p>Cargando usuarios...</p>
        </div>

        <!-- Tabla con datos -->
        <table :style="(usuarios.data && usuarios.data.length > 0) ? '' : 'display: none'">
          <thead>
            <tr>
              <th>RUT</th>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>Email</th>
              <th>Tel√©fono</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="u in usuariosFiltrados" :key="u.rut">
              <tr :style="u.activo === false ? 'opacity: 0.6; background: #f5f5f5;' : ''">
                <td x-text="u.rut"></td>
                <td x-text="u.nombre"></td>
                <td x-text="u.apellido || '-'"></td>
                <td x-text="u.correo"></td>
                <td x-text="u.telefono || '-'"></td>
                <td>
                  <span
                    class="badge"
                    :style="`background: ${getRolColor(u.rol)}; color: white; padding: 4px 12px; border-radius: 12px;`"
                    x-text="getRolLabel(u.rol)">
                  </span>
                </td>
                <td>
                  <span
                    class="badge"
                    :style="`background: ${u.activo !== false ? '#4caf50' : '#f44336'}; color: white; padding: 4px 12px; border-radius: 12px;`"
                    x-text="u.activo !== false ? 'Activo' : 'Inactivo'">
                  </span>
                </td>
                <td>
                  <button class="btn-sm btn-primary" @click="cambiarRol(u)" title="Cambiar Rol" :disabled="u.activo === false">
                    <i class="fas fa-user-tag"></i>
                  </button>
                  <button class="btn-sm btn-secondary" @click="editarUsuario(u)" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    class="btn-sm"
                    :class="u.activo !== false ? 'btn-danger' : 'btn-success'"
                    @click="toggleEstadoUsuario(u)"
                    :title="u.activo !== false ? 'Desactivar' : 'Activar'">
                    <i :class="u.activo !== false ? 'fas fa-ban' : 'fas fa-check'"></i>
                  </button>
                  <button
                    :style="tieneMatriculaPendiente(u) ? '' : 'display: none'"
                    class="btn-sm btn-success"
                    @click="aprobarMatricula(u)"
                    title="Aprobar Matr√≠cula">
                    <i class="fas fa-check-circle"></i>
                  </button>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>


  </div>
</main>

<!-- Modal eventos -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2 id="modalTitle">Nuevo Evento/Evaluaci√≥n</h2>
    <form id="eventForm">
      <input type="hidden" id="eventId">
      <div class="form-group">
        <label for="tituloEvento">T√≠tulo</label>
        <input id="tituloEvento" type="text" name="titulo" required>
      </div>
      <div class="form-group">
        <label for="descripcion">Descripci√≥n</label>
        <textarea id="descripcion" name="descripcion"></textarea>
      </div>
      <div class="form-group">
        <label for="fecha">Fecha</label>
        <input id="fecha" type="date" name="fecha" required>
      </div>
      <div class="form-group">
        <label for="hora">Hora</label>
        <input id="hora" type="time" name="hora">
      </div>
      <div class="form-group">
        <label for="tipo">Tipo</label>
        <select id="tipo" name="tipo">
          <option value="evento">Evento</option>
          <option value="evaluacion">Evaluaci√≥n</option>
        </select>
      </div>
      <div class="form-group">
        <label for="curso">Curso</label>
        <select id="curso" name="curso">
          <option value="todos">Todos</option>
          <option value="medio-mayor">Medio Mayor</option>
          <option value="prekinder-a">Prek√≠nder A</option>
          <option value="prekinder-b">Prek√≠nder B</option>
          <option value="kinder">K√≠nder</option>
          <option value="extension">Extensi√≥n Horaria</option>
        </select>
      </div>
      <div style="text-align:center; margin-top:20px;">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
        <button type="button" class="btn btn-danger" onclick="deleteEvent()">Eliminar</button>
      </div>
    </form>
  </div>
</div>

<!-- SCRIPT -->
<script src="../scripts/admin.js"></script>

<!-- ‚úÖ Alpine.js Apps ahora est√°n en m√≥dulos separados (scripts/admin/*.js) -->


</body>
</html>
